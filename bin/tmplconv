#!/usr/bin/env node

/**
 * Command line interface of tmplconv.
 * This file is auto generated by ape-tmpl.
 */

"use strict";

var program = require('commander'),
    pkg = require('../package'),
    tmplconv = require('../lib');

program
    .version(pkg['version'])
    .description(pkg['description'])
;

//=========================
// Handle `tmplify` command
//=========================

program
    .command("tmplify <srcDir> <destDir>")    .description("Generate a template from existing files")
    .option('-d, --data <data>', "Name or path of data module.")
    .option('-p, --pattern <pattern>', "File name patterns")
    .option('-i, --ignore <ignore>', "File name patterns to ignore")
    .option('-P, --prefix <prefix>', "Embed prefix")
    .option('-S, --suffix <suffix>', "Embed suffix")
    .option('-e, --extname <extname>', "Embed Template extension name")
    .option('-s, --silent', "Disable console logs")
    .option('-c, --clean', "Cleanup destination directory before convert")
    .option('-n, --once', "Write only first time. Skip if already exists")
    .option('-m, --mode', "File permission to generate")
    .action(function act(srcDir, destDir, options) {
        tmplconv.tmplify(srcDir, destDir, options ,done);
    });


//=========================
// Handle `render` command
//=========================

program
    .command("render <srcDir> <destDir>")    .description("")
    .option('-d, --data <data>', "Name or path of data module.")
    .option('-p, --pattern <pattern>', "File name patterns")
    .option('-i, --ignore <ignore>', "File name patterns to ignore")
    .option('-P, --prefix <prefix>', "Embed prefix")
    .option('-S, --suffix <suffix>', "Embed suffix")
    .option('-e, --extname <extname>', "Embed Template extension name")
    .option('-s, --silent', "Disable console logs")
    .option('-c, --clean', "Cleanup destination directory before convert")
    .option('-n, --once', "Write only first time. Skip if already exists")
    .option('-m, --mode', "File permission to generate")
    .action(function act(srcDir, destDir, options) {
        tmplconv.render(srcDir, destDir, options ,done);
    });


//=========================
// Handle `transplant` command
//=========================

program
    .command("transplant <src> <dest>")    .description("Tmplify and render at once")
    .option('-, --rule', "Rule for convert")
    .option('-p, --pattern <pattern>', "File name patterns")
    .option('-i, --ignore <ignore>', "File name patterns to ignore")
    .option('-s, --silent', "Disable console logs")
    .option('-c, --clean', "Cleanup destination directory before convert")
    .option('-n, --once', "Write only first time. Skip if already exists")
    .option('-m, --mode', "File permission to generate")
    .action(function act(src, dest, options) {
        tmplconv.transplant(src, dest, options ,done);
    });


program.parse(process.argv);

//=========================
// Check sub command
//=========================

(function checkCommand(command) {
    if (!command) {
        program.outputHelp();
        return;
    }
    var invalid = program.commands.map(function (command) {
            return command.name();
        }).indexOf(command) === -1;
    if (invalid) {
        console.log("[tmplconv] '%s' is not an tmplconv command. See 'tmplconv --help'.", command);
    }

})(process.argv[2]);


/** When command done. */
function done(err) {
    if (err) {
        console.error(err);
        process.exit(1);
    } else {
        process.exit(0);
    }
}
